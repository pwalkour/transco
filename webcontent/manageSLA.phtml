<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<title>Transco : ajouter une sla</title>
<link rel="stylesheet" href="styles/main_transco_style.css" />
<script>
function getOneElementTable(aReference,aKey)
{
	$returnStr="";
	 xx=aReference.getElementsByTagName(aKey);
     {
     try { $returnStr= "<td>" + xx[0].firstChild.nodeValue + "</td>"; }
     catch (er) { $returnStr = "<td>&nbsp;</td>"; }
     }
     return $returnStr;
}

function getOneElementData(aReference,aKey)
{
	$returnStr="";
	 xx=aReference.getElementsByTagName(aKey);
     {
     try { $returnStr= xx[0].firstChild.nodeValue ; }
     catch (er) { $returnStr = "-?-"; }
     }
     return $returnStr;
}

function getSlaTableHeader(aPattern){
	  txtgetSlaTableHeader="<tr>";
	  if (aPattern=="all" || aPattern.lastIndexOf("1")>=0) { txtgetSlaTableHeader=txtgetSlaTableHeader+"<th>SLA Code</th>" };
	  if (aPattern=="all" || aPattern.lastIndexOf("2")>=0) { txtgetSlaTableHeader=txtgetSlaTableHeader+"<th>Effective Date</th>" };
	  if (aPattern=="all" || aPattern.lastIndexOf("3")>=0) { txtgetSlaTableHeader=txtgetSlaTableHeader+"<th>Serial</th>" };
	  if (aPattern=="all" || aPattern.lastIndexOf("4")>=0) { txtgetSlaTableHeader=txtgetSlaTableHeader+"<th>Est Actif</th>" };
	  if (aPattern=="all" || aPattern.lastIndexOf("5")>=0) { txtgetSlaTableHeader=txtgetSlaTableHeader+"<th>Nom Français</th>" };
	  if (aPattern=="all" || aPattern.lastIndexOf("6")>=0) { txtgetSlaTableHeader=txtgetSlaTableHeader+"<th>Nom Anglais</th>" };
	  txtgetSlaTableHeader=txtgetSlaTableHeader+"</tr>";
	  return txtgetSlaTableHeader;
}
function getSlaDailyData(aDate,aNavigate)
{

	var urlSlaDailyData="./scripts/sla/getSlaDailyData.php?effdt='"+aDate+"'&nav='"+aNavigate+"'";
	//var url="getSlaDailyData2.php?effdt='2013-01-28'"; 
	var xmlhttpSlaDailyData;
	var xSlaDailyData,name_fr,name_uk,is_used;
	document.getElementById('tutu').value=urlSlaDailyData;
	//alert(aDate);
	
	if (window.XMLHttpRequest)
	{// code for IE7+, Firefox, Chrome, Opera, Safari 
		xmlhttpSlaDailyData=new XMLHttpRequest();
	}
	else
	{// code for IE6, IE5 
		xmlhttpSlaDailyData=new ActiveXObject("Microsoft.XMLHTTP");
	}
	
	xmlhttpSlaDailyData.onreadystatechange=function()
	{
		if (xmlhttpSlaDailyData.readyState==4 && xmlhttpSlaDailyData.status==200)
		{
			txtGetSlaDailyData="<table border='1'>";
			txtGetSlaDailyData=txtGetSlaDailyData+getSlaTableHeader("all");
			xSlaDailyData=xmlhttpSlaDailyData.responseXML.documentElement.getElementsByTagName("sla");
			for (i=0;i<xSlaDailyData.length;i++)
			{
				txtGetSlaDailyData=txtGetSlaDailyData + "<tr>";
				txtGetSlaDailyData=txtGetSlaDailyData+getOneElementTable(xSlaDailyData[i],"id_sla");
				txtGetSlaDailyData=txtGetSlaDailyData+getOneElementTable(xSlaDailyData[i],"effdt");
				txtGetSlaDailyData=txtGetSlaDailyData+getOneElementTable(xSlaDailyData[i],"serial");
				txtGetSlaDailyData=txtGetSlaDailyData+getOneElementTable(xSlaDailyData[i],"is_used");
				txtGetSlaDailyData=txtGetSlaDailyData+getOneElementTable(xSlaDailyData[i],"sla_name_fr");
				txtGetSlaDailyData=txtGetSlaDailyData+getOneElementTable(xSlaDailyData[i],"sla_name_uk");
				//txt=txt+"<td><form methode='POST'><input type='submit' value='Edit' onclick='UpdateSla("+getOneElementData(x[i],'id_sla')+","+aDate+","+aNavigate+")' /></form></td>";
				txtGetSlaDailyData=txtGetSlaDailyData + "</tr>";
			}
			txtGetSlaDailyData=txtGetSlaDailyData + "</table>";
			document.getElementById('CurrentDate').value=getOneElementData(xSlaDailyData[0],"effdt");
			document.getElementById('effdt').value=getOneElementData(xSlaDailyData[0],"effdt");
			document.getElementById('slaInfoTbl').innerHTML=txtGetSlaDailyData;
		}
	}
	xmlhttpSlaDailyData.open("GET",urlSlaDailyData,true);
	xmlhttpSlaDailyData.send();
}

function updateSla (aDate,aNavigate)
{
	var urlUpdateSla="./scripts/sla/getSlaDailyData.php?effdt='"+aDate+"'&nav='"+aNavigate+"'";
	//var url="getSlaDailyData2.php?effdt='2013-01-28'"; 
	var xmlhttpUpdateSla;
	var xUpdateSla,name_fr,name_uk,is_used;
	document.getElementById('tutu').value=urlUpdateSla;
	//alert(aDate);
	
	if (window.XMLHttpRequest)
	{// code for IE7+, Firefox, Chrome, Opera, Safari 
		xmlhttpUpdateSla=new XMLHttpRequest();
	}
	else
	{// code for IE6, IE5 
		xmlhttpUpdateSla=new ActiveXObject("Microsoft.XMLHTTP");
	}
	
	xmlhttpUpdateSla.onreadystatechange=function()
	{
		if (xmlhttpUpdateSla.readyState==4 && xmlhttpUpdateSla.status==200)
		{
			// use html parser
			document.getElementById('effdt').value=aDate;
			//txtUpdateSla=txtUpdateSla+"<br><br>quel est l'effective date : <input id='effdtUpd' name='effdtUpd' autofocus type='date' value='"+aDate+"'><br>"
			txtUpdateSla="<form methode='POST'>";
			txtUpdateSla=txtUpdateSla+"<br><br><table border='1'>"
			txtUpdateSla=txtUpdateSla+getSlaTableHeader("1456"); 
			xUpdateSla=xmlhttpUpdateSla.responseXML.documentElement.getElementsByTagName("sla");
			for (i=0;i<xUpdateSla.length;i++)
			{
				txtUpdateSla=txtUpdateSla+"<tr>";
				txtUpdateSla=txtUpdateSla+getOneElementTable(xUpdateSla[i],"id_sla");
				//txtUpdateSla=txtUpdateSla+getOneElementTable(xUpdateSla[i],"effdt");
				if (getOneElementData(xUpdateSla[i],"is_used")==0) {
					txtUpdateSla=txtUpdateSla
						+"<td>"
						+"<select id='isUsed' name='isUsed' required>"
						+"<option value='0' selected> Inactif</option>"
						+"<option value='1' > Actif</option>"
						+"</select>"
						+"</td>"; // is_used 
				}
				else {
					txtUpdateSla=txtUpdateSla
					+"<td>"
					+"<select id='isUsed' name='isUsed' required>"
					+"<option value='0' > Inactif</option>"
					+"<option value='1' selected> Actif</option>"
					+"</select>"
					+"</td>"; // is_used 

				}
				txtUpdateSla=txtUpdateSla+"<td><input id='frenshName' name='frenshName' required value='"+getOneElementData(xUpdateSla[i],"sla_name_fr")+"' /></td>"; // sla_name_fr 
				txtUpdateSla=txtUpdateSla+"<td><input id='englishName' name='englishName' required value='"+getOneElementData(xUpdateSla[i],"sla_name_uk")+"' /></td>"; //sla_name_uk 
				txtUpdateSla=txtUpdateSla+"</tr>";
			}
			txtUpdateSla=txtUpdateSla + "</table><br>";
			txtUpdateSla=txtUpdateSla + "<input type='button' value='Ecrire' onclick='getSlaDailyData(document.getElementById("+"\""+"effdtUpd"+"\""+").value,"+"\""+"current"+"\""+")' />";
			txtUpdateSla=txtUpdateSla+"</form>";
			document.getElementById('CurrentDate').value=document.getElementById('effdt').value;
			document.getElementById('slaInfoTbl').innerHTML=txtUpdateSla;
		}
	}
	xmlhttpUpdateSla.open("GET",urlUpdateSla,true);
	xmlhttpUpdateSla.send();

}

function getSlaTableAsArray(elementId) {
	table = document.getElementById( elementId );
	tableArray = [];
	for ( i = 1; i < $table.rows.length; i++ ) {
    	tableArray.push({
    		id_sla: table.rows[i].cells[0].innerHTML,
    		effdt: table.rows[i].cells[1].innerHTML,
    		serial: table.rows[i].cells[2].innerHTML,
    		is_used: table.rows[i].cells[3].innerHTML,
    		sla_name_fr: table.rows[i].cells[4].innerHTML,
    		sla_name_uk: table.rows[i].cells[5].innerHTML
    	}
        );
	}
    return tableArray;
}

</script>

</head>
<body>
<textarea id="tutu" name="tutu" rows="3" cols="30" > 
   Texte affiché dans la balise textarea en tttttt
</textarea>
<!-- <form method="POST" > -->
<br>
quel est l'effective date : <input id="effdt" name="effdt" autofocus type="date" onblur="getSlaDailyData(this.value,'current')" /><br>
 <!-- <input type="submit" value="record"> -->
<!-- </form> -->
<input type="hidden" name="CurrentDate" id="CurrentDate"/>

<input type=button value="SLA précédente" onclick="getSlaDailyData(document.getElementById('CurrentDate').value,'previous')" />
<input type=button value="SLA edition" onclick="updateSla(document.getElementById('CurrentDate').value,'current')" />
<input type=button value="SLA suivante" onclick="getSlaDailyData(document.getElementById('CurrentDate').value,'next')" />
 

<div id="slaInfoTbl">
</div>
<div id="slaUpdForm">
</div>


</body>
</html>



